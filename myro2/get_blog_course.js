"use strict";// 여행기 열기/닫기
function showTravelogModal(){//end ajax getBlogList
$.ajax({type:"GET",url:"/getBlogList",data:{cityName:cityName},success:function success(res){var appendBookmarkHtml="",appendIframeHtml="";appendIframeHtml=600>=$(window).width()?"<iframe src=\"".concat(res.blog_location_mobile_href,"\" class=\"travelog-frame\" loading=\"lazy\" sandbox=\"allow-scripts allow-forms allow-same-origin\"></iframe>"):"<iframe src=\"".concat(res.blog_location_href,"\" class=\"travelog-frame\" loading=\"lazy\" sandbox=\"allow-scripts allow-forms allow-same-origin\"></iframe>");$("#blogIframe").html(appendIframeHtml),$("#mobileBlogCourseSelect").html("<option value=\"\" disabled selected>\uC5EC\uD589\uAE30 \uBAA9\uB85D \uC5F4\uAE30</option>");for(var i=0;i<res.otherBlogData.length;i++){appendBookmarkHtml+="\n                            <div title=\"".concat(res.otherBlogData[i].blogTitle,"\" class=\"travelog-bookmark-button\" data-idx='").concat(res.otherBlogData[i].blogIdx,"' onclick=\"getBlogFromBookMark(this)\">\n                                <div class=\"travelog-bookmark-button-text\">").concat(res.otherBlogData[i].blogName,"</div>\n                                <div class=\"travelog-bookmark-button-text-small\">").concat(res.otherBlogData[i].blogCreatedAt,"</div>\n                            </div>");var blogTitleText=res.otherBlogData[i].blogTitle;20<blogTitleText.length&&(blogTitleText=blogTitleText.substring(0,20)+"..."),$("#mobileBlogCourseSelect").append("<option title=\"".concat(res.otherBlogData[i].blogTitle,"\" value=\"").concat(i,"\" data-idx=").concat(res.otherBlogData[i].blogIdx," >").concat(blogTitleText,"</option>")),blogTitleText=null}//end for i
//end ajax getBlogSpotListForFirstIframe
$("#blogBookmark").html(appendBookmarkHtml),$.ajax({type:"GET",url:"/getBlogSpotListForFirstIframe",data:{cityName:cityName,blogSpotData:JSON.parse(res.spots_no)},success:function success(data){for(var _i=0;_i<data.length;_i++)searchedSpotsList.push(data[_i]);setBlogAppendHtml(data,JSON.parse(res.spots_no))}//end success
}),appendBookmarkHtml=null,appendIframeHtml=null}//end success
}),document.getElementById("travelogModal").style.display="flex",addUserTrackingData("showTravelogModal|"+cityName)}//end showTravelogModal
function MobileSelectBlog(){getBlogFromBookMark(document.getElementById("mobileBlogCourseSelect").options[document.getElementById("mobileBlogCourseSelect").selectedIndex])}//end MobileSelectBlog
function setBlogAppendHtml(_data,_spotsNo){for(var spotTemp,i=0;i<_spotsNo.length;i++)for(var j=0;j<_spotsNo.length;j++)_data[i].no==_spotsNo[j]&&(spotTemp=_data[i],_data[i]=_data[j],_data[j]=spotTemp);for(var appendBlogSpotListHtml="",_i2=0;_i2<_data.length;_i2++){var bookmark="",titleForPlaceType="",backgroundColor=void 0;if(0==_data[_i2].isSpot?(bookmark="restaurant",titleForPlaceType=i18nSvc.get("restaurant"),backgroundColor="#ff4081"):1==_data[_i2].isSpot?(bookmark="account_balance",titleForPlaceType=i18nSvc.get("spot")):2==_data[_i2].isSpot&&(bookmark="hotel",titleForPlaceType=i18nSvc.get("hotel"),backgroundColor="#1a237e"),-1!=_data[_i2].showingName.indexOf("(")&&(_data[_i2].showingName=_data[_i2].showingName.split("(")[0]),appendBlogSpotListHtml+="\n                    <div class=\"travelog-spot-card-conteiner\">\n                    <div class=\"travelog-spot-card\">\n\n                        <div style=\"position:relative\">\n                            <div class=\"travelog-spot-placecardbookmark\" style=\"background-color:".concat(backgroundColor,"\">\n                            <i title=\"").concat(titleForPlaceType,"\" class=\"material-icons placecardbookmark_mi\">").concat(bookmark,"</i>\n                        </div>\n                            <img class=\"travelog-spot-card-image\" src=\"https://www.myro.co.kr/getSpotImage/").concat(cityName,"?no=").concat(_data[_i2].no,"\" alt=\"image\" />\n                        </div>\n                        <div class=\"travelog-spot-card-text-container\">\n                            <div class=\"travelog-spot-card-name\" title=\"").concat(_data[_i2].showingName,"\">").concat(_data[_i2].showingName,"</div>\n                            <div style=\"display: flex\">"),2==_data[_i2].isSpot?(searchedSpotsList.push(_data[_i2]),appendBlogSpotListHtml+="\n                                <div class=\"travelog-spot-card-info-btn\" onclick=\"hotelInfoModal(".concat(_data[_i2].no,")\">\uC815\uBCF4</div>\n                                ")):appendBlogSpotListHtml+="\n                                <div class=\"travelog-spot-card-info-btn\" onclick=\"spotInfoModal(".concat(_data[_i2].no,")\">\uC815\uBCF4</div>\n                                "),2==_data[_i2].isSpot)appendBlogSpotListHtml+="\n                                    <div class=\"travelog-spot-card-add-btn\" onclick=\"setHotel(".concat(_data[_i2].no,")\">\uCD94\uAC00</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>");else{for(var blogSpotIsSelected=!1,_j=0;_j<selectedSpots.length;_j++)if(selectedSpots[_j].no==_data[_i2].no){blogSpotIsSelected=!0;break}appendBlogSpotListHtml+=blogSpotIsSelected?"\n                                        <div class=\"travelog-spot-card-remove-btn\" id=\"addOrRemoveInBlogBtn_idx_".concat(_data[_i2].no,"\" onclick=\"removeSpotFromSelectedSpotsFromBlog(").concat(_data[_i2].no,", this)\">\uC0AD\uC81C</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>"):"\n                                        <div class=\"travelog-spot-card-add-btn\" id=\"addOrRemoveInBlogBtn_idx_".concat(_data[_i2].no,"\" onclick=\"addSpotToSelectedSpotsFromBlog(").concat(_data[_i2].no,", this)\">\uCD94\uAC00</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>"),blogSpotIsSelected=null,bookmark=null,titleForPlaceType=null,backgroundColor=null}//end if _data[i].isSpot==2
}//end for i
$("#blogSpotList").html(appendBlogSpotListHtml),appendBlogSpotListHtml=null}//end setBlogAppendHtml
function addSpotToSelectedSpotsFromBlog(no,_param){function recalculateSumOfSpotStayingMins(){0==$("#stayingHoursNo"+spot.no).val()&&0==$("#stayingMinutesNo"+spot.no).val()&&$("#stayingMinutesNo"+spot.no).val(1),sumOfSpotStayingMins=0;for(var _no,_i4=0;_i4<selectedSpots.length;_i4++)_no=selectedSpots[_i4].no,sumOfSpotStayingMins+=60*+$("#stayingHoursNo"+_no).val()+ +$("#stayingMinutesNo"+_no).val(),_no=null;var sumOfSpotStayingH=Math.floor(sumOfSpotStayingMins/60),sumOfSpotStayingM=Math.floor(sumOfSpotStayingMins%60);$("#sumOfSpotStayingH").html(sumOfSpotStayingH),$("#sumOfSpotStayingM").html(sumOfSpotStayingM),sumOfSpotStayingH=null,sumOfSpotStayingM=null}if($("#selecteSpotsTab").get(0).click(),closeDailyTimesSettingArea(),infowindow&&infowindow.close(),!$("#travelDay").val())return void showToastMsg(i18nSvc.get("setYourTravelDate"));if(7<(selectedSpots.length+1)/$("#travelDay").val())return void showToastMsg(i18nSvc.get("cantChooseMoreThan8PlacesPerDayForAverage"));for(var spot,i=0;i<searchedSpotsList.length;i++)if(searchedSpotsList[i].no==no){spot=searchedSpotsList[i];continue}for(var _i3=0;_i3<selectedSpots.length;_i3++)if(selectedSpots[_i3].no==spot.no)return void showToastMsg(spot.showingName+i18nSvc.get("isAlreadySelected"));if(sumOfSpotStayingMins+spot.recommendedStaySec/60>totalTravelMins)return showToastMsg(i18nSvc.get("sumOfStayingTimeOfPlacesCannotBeGreaterThanTotalTravelTime")),$("#totalTravelTimeArea").addClass("blink-2"),$("#totalSpendingTimeArea").addClass("blink-2"),void setTimeout(function(){$("#totalTravelTimeArea").removeClass("blink-2"),$("#totalSpendingTimeArea").removeClass("blink-2")},3e3);isClickedToPreventMaker=!0,setTimeout(function(){isClickedToPreventMaker=!1},200),sumOfSpotStayingMins+=spot.recommendedStaySec/60;var sumOfSpotStayingH=Math.floor(sumOfSpotStayingMins/60),sumOfSpotStayingM=Math.floor(sumOfSpotStayingMins%60);$("#sumOfSpotStayingH").html(sumOfSpotStayingH),$("#sumOfSpotStayingM").html(sumOfSpotStayingM),selectedSpots.push(spot),$("#chipNo"+no).addClass("chipSelectedCss"),$("#miNo"+no).html("check"),$("#appendDiv"+no).remove(),refreshSeletedSpotsCnt(),setMarkerOnMap(spot),map.panTo({lat:spot.lat,lng:spot.lng});var titleForPlaceType,backgroundColor,bookmark="";0==spot.isSpot?(bookmark="restaurant",backgroundColor="#ff4081",titleForPlaceType=i18nSvc.get("restaurant")):1==spot.isSpot&&(bookmark="account_balance",titleForPlaceType=i18nSvc.get("spot"));var recommendedStayHours=Math.floor(spot.recommendedStaySec/3600),recommendedStayMinutes=spot.recommendedStaySec%3600/60,addCart="<li class=\"display-container fade-in-right addcartspotdiv1\" id=\"cartNo"+spot.no+"\">"+"<div style=\"display:flex;padding:8px;width:100%\"><div>"+"<img src=\""+headAddress+"/getSpotImage/"+cityName+"?no="+spot.no+"\" alt=\"Image\" loading=\"lazy\"></div>"+"<div class=\"placecardbookmark\" style=\"background-color:"+backgroundColor+"\"><i title=\""+titleForPlaceType+"\" class=\"material-icons placecardbookmark_mi\">"+bookmark+"</i></div>"+"<div class=\"addcartdpottextdiv\"><h7 class=\"placelistnd\" title=\""+spot.showingName+"\">"+spot.showingName+"</h7><div class=\"addcartspotdiv2\">"+"<i title=\""+i18nSvc.get("stayingTime")+"\" class=\"material-icons\">timer</i>&nbsp&nbsp&nbsp&nbsp<input id=\""+"stayingHoursNo"+spot.no+"\" type=\"number\" min=\"0\" max=\"24\" value=\""+recommendedStayHours+"\" size=\"1\">"+i18nSvc.get("hours")+"&nbsp&nbsp&nbsp&nbsp<input id=\""+"stayingMinutesNo"+spot.no+"\" type=\"number\" value=\""+recommendedStayMinutes+"\" size=\"1\" maxlength=\"2\" min=\"0\" max=\"59\">"+i18nSvc.get("min")+"</div></div></div>"+"<div onclick=\"removeSpotFromSelectedSpots("+spot.no+")\" class=\"btn addcartspotdivbtn\">"+"<i title=\""+i18nSvc.get("removeFromSelectedList")+"\" class=\"material-icons\">clear</i></div></li>";$("#cart2NoList").css("display","none"),$("#cart2").append(addCart),$("#stayingHoursNo"+spot.no).change(function(){23<$("#stayingHoursNo"+spot.no).val()&&$("#stayingHoursNo"+spot.no).val(23),0>$("#stayingHoursNo"+spot.no).val()&&$("#stayingHoursNo"+spot.no).val(0),recalculateSumOfSpotStayingMins(),addUserTrackingData("stayingHours change|"+spot.no+"|"+$("#stayingHoursNo"+spot.no).val())}),$("#stayingMinutesNo"+spot.no).change(function(){59<$("#stayingMinutesNo"+spot.no).val()&&$("#stayingMinutesNo"+spot.no).val(59),0>$("#stayingMinutesNo"+spot.no).val()&&$("#stayingMinutesNo"+spot.no).val(0),recalculateSumOfSpotStayingMins(),addUserTrackingData("stayingMinutes change|"+spot.no+"|"+$("#stayingMinutesNo"+spot.no).val())}),w3_open(),600<$(window).width()&&($("#searchSpotOrHotelKeyword").val(""),$("#searchSpotOrHotelKeyword").focus()),addUserTrackingData("addSpotToSelectedSpotsFromBlog|"+no),_param.innerHTML="\uC0AD\uC81C",_param.setAttribute("class","travelog-spot-card-remove-btn"),_param.setAttribute("onclick","removeSpotFromSelectedSpotsFromBlog(".concat(no,",this)")),spot=null,sumOfSpotStayingH=null,sumOfSpotStayingM=null,bookmark=null,titleForPlaceType=null,backgroundColor=null,recommendedStayHours=null,recommendedStayMinutes=null,addCart=null}//end addSpotToSelectedSpotsFromBlog
function removeSpotFromSelectedSpotsFromBlog(no,_param){for(var i=0;i<selectedSpots.length;i++)if(selectedSpots[i].no==no){selectedSpots.splice(i,1),sumOfSpotStayingMins-=60*+$("#stayingHoursNo"+no).val()+ +$("#stayingMinutesNo"+no).val();var sumOfSpotStayingH=Math.floor(sumOfSpotStayingMins/60),sumOfSpotStayingM=Math.floor(sumOfSpotStayingMins%60);$("#sumOfSpotStayingH").html(sumOfSpotStayingH),$("#sumOfSpotStayingM").html(sumOfSpotStayingM),sumOfSpotStayingH=null,sumOfSpotStayingM=null;continue}for(var _i5=0;_i5<markers.length;_i5++)markers[_i5].spotNo==no&&(markers[_i5].setMap(null),markers.splice(_i5,1),_i5--);//html 요소 제거 로직 추가
$("#cartNo"+no).remove(),refreshSeletedSpotsCnt(),_param.innerHTML="\uCD94\uAC00",_param.setAttribute("class","travelog-spot-card-add-btn"),_param.setAttribute("onclick","addSpotToSelectedSpotsFromBlog(".concat(no,",this)")),addUserTrackingData("removeSpotFromSelectedSpotsFromBlog|"+no)}//end removeSpotFromSelectedSpotsFromBlog
function getBlogFromBookMark(_param){$.ajax({type:"GET",url:"/getBlogListFromBookMark",data:{blogNo:_param.dataset.idx},success:function success(res){var appendIframeHtml="";appendIframeHtml=600>=$(window).width()?"<iframe src=\"".concat(res.blog_location_mobile_href,"\" class=\"travelog-frame\" loading=\"lazy\" sandbox=\"allow-scripts allow-forms allow-same-origin\"></iframe>"):"<iframe src=\"".concat(res.blog_location_href,"\" class=\"travelog-frame\" loading=\"lazy\" sandbox=\"allow-scripts allow-forms allow-same-origin\"></iframe>");//end ajax getBlogSpotListForFirstIframe
$("#blogIframe").html(appendIframeHtml),$.ajax({type:"GET",url:"/getBlogSpotListForFirstIframe",data:{cityName:cityName,blogSpotData:JSON.parse(res.spots_no)},success:function success(data){for(var i=0;i<data.length;i++)searchedSpotsList.push(data[i]);setBlogAppendHtml(data,JSON.parse(res.spots_no))}//end success
}),appendIframeHtml=null}})}//end getBlogFromBookMark
function hideTravelogModal(){document.getElementById("travelogModal").style.display="none",$("#blogIframe").html(""),$("#blogBookmark").html("")}//end hideTravelogModal